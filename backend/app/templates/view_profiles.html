{% extends "base.html" %}
{% set background_image = url_for('static', filename='images/view_profiles_background.jpg') %}

{% block title %}View Profile{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-header text-center">
        <!-- Verifica si `profile.picture.large` existe, de lo contrario muestra la imagen por defecto -->
        <img src="{{ profile.picture.large if profile.picture.large else url_for('static', filename='images/default_profile.jpg') }}" 
             alt="Profile Picture" class="profile-img">
        
        <h1>{{ profile.name.first }} {{ profile.name.last }}</h1>
        <p><strong>Username:</strong> {{ profile.login.username }}</p>
        <p><strong>📧 Email:</strong> {{ profile.email }}</p>
        <p><strong>🎂 Age:</strong> {{ profile.age }}</p>
        <p><strong>📍 Location:</strong> {{ profile.location.city }}, {{ profile.location.country }}</p>
    </div>

    <!-- Acciones -->
    <div class="text-center mt-4">
        <button class="btn btn-danger" onclick="sendLike({{ profile.id }})">❤️ Like</button>
        
        {% if profile.mutual_like %}
        <a href="{{ url_for('chat.start_chat', user_id=profile.id) }}" class="btn btn-primary">💬 Chat</a>
        {% endif %}
        
        <button class="btn btn-secondary" onclick="blockUser({{ profile.id }})">🚫 Block</button>
        <button class="btn btn-warning" onclick="reportUser({{ profile.id }})">⚠️ Report</button>

        <!-- URL válida para volver atrás -->
        <a href="{{ url_for('profiles.get_all_profiles') }}" class="btn btn-outline-light mt-3">⬅️ Go Back</a>
    </div>
</div>

<!-- JavaScript para manejar las acciones con fetch() -->
<script>
function sendLike(userId) {
    fetch(`/like/${userId}`, { 
        method: 'POST', 
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId }) 
    })
    .then(response => response.json())
    .then(data => alert(data.message))
    .catch(error => console.error("Error sending like:", error));
}

function blockUser(userId) {
    fetch(`/block/${userId}`, { 
        method: 'POST', 
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId }) 
    })
    .then(response => response.json())
    .then(data => alert(data.message))
    .catch(error => console.error("Error blocking user:", error));
}

function reportUser(userId) {
    fetch(`/report/${userId}`, { 
        method: 'POST', 
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId }) 
    })
    .then(response => response.json())
    .then(data => alert(data.message))
    .catch(error => console.error("Error reporting user:", error));
}
</script>
{% endblock %}







